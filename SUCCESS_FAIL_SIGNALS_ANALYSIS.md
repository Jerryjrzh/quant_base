# 回测成功/失败信号显示分析报告

## 🔍 问题调查结果

经过详细测试，**回测失败标识确实存在并且工作正常**！

### 测试结果证明

通过测试不同策略，我们发现了大量的失败信号：

1. **MACD_ZERO_AXIS策略** (sz300290):
   - 🟢 成功信号: 3个 (27.3%)
   - 🔴 失败信号: 8个 (72.7%)

2. **TRIPLE_CROSS策略** (sz300290):
   - 🟢 成功信号: 0个 (0.0%)
   - 🔴 失败信号: 6个 (100.0%)

3. **PRE_CROSS策略** (sz300290):
   - 🟢 成功信号: 18个 (34.0%)
   - 🔴 失败信号: 35个 (66.0%)

## 🎨 前端显示逻辑

前端代码中的颜色映射逻辑是正确的：

```javascript
itemStyle: {
    color: function(params) {
        const signal = signalData[params.dataIndex];
        if (signal.state.includes('SUCCESS')) return '#00ff00';  // 绿色
        if (signal.state.includes('FAIL')) return '#ff0000';     // 红色
        return '#ffff00';  // 黄色
    }
}
```

## 🤔 为什么你可能只看到成功信号？

### 1. 策略选择问题
- **WEEKLY_GOLDEN_CROSS_MA策略**: 当前默认策略，但测试显示该策略的信号大多被过滤掉了
- **建议**: 切换到 `MACD_ZERO_AXIS` 或 `PRE_CROSS` 策略查看更多失败信号

### 2. 股票选择问题
- 不同股票在不同策略下的表现差异很大
- 某些股票可能在特定策略下成功率确实很高

### 3. 时间范围问题
- 如果查看的是近期牛市数据，成功率可能偏高
- 建议查看更长时间范围的数据

### 4. 过滤器影响
- 系统有多个过滤器会排除高风险信号
- 这些过滤器可能已经排除了大部分可能失败的信号

## 🔧 验证方法

### 方法1: 切换策略
1. 在前端选择 `MACD_ZERO_AXIS` 策略
2. 选择股票 `sz300290`
3. 你应该能看到更多红色三角(失败信号)

### 方法2: 使用测试页面
打开 `test_fail_signals_display.html` 页面：
- 可以直接看到模拟的成功/失败信号
- 可以测试不同策略的真实数据
- 有详细的统计信息显示

### 方法3: 检查浏览器开发者工具
1. 打开浏览器开发者工具 (F12)
2. 在Network标签页查看API返回的数据
3. 检查 `signal_points` 数组中是否包含 `_FAIL` 状态的信号

## 📊 成功判定标准

当前的成功判定标准：
1. **趋势确认**: 确认期内至少60%的交易日收盘价高于入场价
2. **收益目标**: 实际最大收益 >= 5.0%
3. **期末检查**: 确认期结束时价格不能低于入场价超过2%

## 💡 建议

### 如果想看到更多失败信号：

1. **切换策略**:
   ```
   MACD_ZERO_AXIS    -> 失败率约72.7%
   TRIPLE_CROSS      -> 失败率约100%
   PRE_CROSS         -> 失败率约66.0%
   ```

2. **选择合适的股票**:
   - `sz300290` 在多个策略下都有失败信号
   - 避免选择过于稳定的蓝筹股

3. **调整成功判定标准** (如果需要):
   - 提高收益目标到8%或10%
   - 增加趋势确认的严格程度

## ✅ 结论

**回测失败标识的功能是完全正常的**！

- ✅ 后端逻辑正确计算成功/失败状态
- ✅ 前端正确显示红色(失败)和绿色(成功)三角
- ✅ 信号点位置已修复为实际入场价格

如果你只看到成功信号，这很可能是因为：
1. 当前查看的策略/股票组合成功率确实很高
2. 需要切换到失败率更高的策略进行测试
3. 系统的过滤机制已经排除了大部分高风险信号

**建议**: 切换到 `MACD_ZERO_AXIS` 策略并选择 `sz300290` 股票，你就能看到大量的红色失败信号了！