# 复权功能使用指南

## 概述

本系统已集成完整的股票复权处理功能，支持前复权、后复权和不复权三种模式，帮助用户更准确地进行技术分析。

## 功能特点

### 1. 复权类型支持
- **前复权 (Forward Adjustment)**: 调整历史价格，保持最新价格不变
- **后复权 (Backward Adjustment)**: 调整当前价格，保持历史价格不变  
- **不复权 (No Adjustment)**: 使用原始价格数据

### 2. 智能检测
- 自动检测价格跳跃点（可能的除权除息点）
- 基于15%价格变化阈值进行判断
- 支持分红和拆股调整

### 3. 技术指标集成
- MACD指标支持复权处理
- KDJ指标支持复权处理
- 移动平均线自动适配复权数据

## 使用方法

### 前端操作

1. **选择复权方式**
   - 在控制面板中找到"复权"下拉菜单
   - 选择所需的复权类型：
     - `前复权`: 推荐用于技术分析
     - `后复权`: 适合查看真实收益
     - `不复权`: 查看原始价格

2. **查看效果**
   - 选择不同复权方式后，图表会自动刷新
   - 技术指标会根据复权数据重新计算
   - 交易建议也会基于复权数据生成

### API调用

```javascript
// 获取前复权数据
fetch(`/api/analysis/${stockCode}?strategy=${strategy}&adjustment=forward`)

// 获取后复权数据  
fetch(`/api/analysis/${stockCode}?strategy=${strategy}&adjustment=backward`)

// 获取不复权数据
fetch(`/api/analysis/${stockCode}?strategy=${strategy}&adjustment=none`)
```

## 复权算法说明

### 价格跳跃检测
```python
# 检测超过15%的价格变化
price_changes = df['close'].pct_change().abs()
jump_threshold = 0.15
jump_points = price_changes > jump_threshold
```

### 前复权计算
- 从最新的除权点开始，向前调整历史价格
- 调整因子 = 除权后价格 / 除权前价格
- 历史价格 × 调整因子

### 后复权计算  
- 从最早的除权点开始，向后调整当前价格
- 调整因子 = 除权前价格 / 除权后价格
- 当前价格 × 调整因子

## 使用建议

### 1. 技术分析推荐
- **首选前复权**: 保持最新价格真实性，便于制定交易策略
- 移动平均线、MACD等指标更加连续
- 避免因除权造成的技术指标失真

### 2. 收益分析推荐
- **使用后复权**: 能够准确反映投资收益
- 适合计算长期持有收益率
- 便于比较不同时期的投资表现

### 3. 原始数据查看
- **使用不复权**: 查看真实的历史价格
- 了解除权除息的具体影响
- 进行基本面分析时的参考

## 注意事项

### 1. 数据准确性
- 复权算法基于价格跳跃检测，可能存在误判
- 建议结合公司公告确认除权除息信息
- 对于频繁分红的股票，复权效果更明显

### 2. 指标计算
- 复权会影响所有基于价格的技术指标
- 成交量会进行反向调整以保持一致性
- 建议在同一复权方式下进行指标对比

### 3. 性能考虑
- 复权处理会增加计算时间
- 系统已启用缓存机制提高性能
- 大量数据处理时建议分批进行

## 测试验证

运行测试脚本验证复权功能：

```bash
python test_adjustment_display.py
```

测试内容包括：
- 不同复权方式的价格对比
- 技术指标计算验证
- 前端集成测试
- 性能测试

## 故障排除

### 常见问题

1. **复权效果不明显**
   - 检查股票是否有除权除息历史
   - 确认价格跳跃检测阈值设置
   - 验证数据时间范围

2. **技术指标异常**
   - 确认复权设置是否正确应用
   - 检查指标配置参数
   - 验证数据完整性

3. **前端显示问题**
   - 检查复权选择器是否正常工作
   - 确认API参数传递正确
   - 验证图表刷新机制

### 调试信息

系统会在控制台输出复权处理信息：
```
📊 复权处理 sh688531: forward
📊 KDJ复权处理 sh688531: forward, 调整次数: 2, 价格比例: 1.0234
```

## 更新日志

### v1.0 (2025-07-28)
- ✅ 实现基础复权功能
- ✅ 集成前端复权选择器
- ✅ 支持MACD和KDJ指标复权
- ✅ 添加价格跳跃检测算法
- ✅ 实现缓存机制优化性能

### 计划功能
- 🔄 精确复权因子数据集成
- 🔄 复权历史记录功能
- 🔄 复权效果可视化对比
- 🔄 自定义复权参数设置

## 技术支持

如遇到问题，请：
1. 查看控制台调试信息
2. 运行测试脚本验证
3. 检查数据文件完整性
4. 参考本文档故障排除部分