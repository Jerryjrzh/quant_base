<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æŒä»“ç®¡ç†æŒ‰é’®ä¿®å¤æµ‹è¯•</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.3.3/dist/echarts.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: white; margin: 15% auto; padding: 20px; border-radius: 5px; width: 80%; max-width: 600px; }
        .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close:hover { color: #000; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
    </style>
</head>
<body>
    <h1>æŒä»“ç®¡ç†æŒ‰é’®ä¿®å¤æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>æµ‹è¯•ç»“æœ</h2>
        <div id="test-results"></div>
    </div>
    
    <div class="test-section">
        <h2>æ¨¡æ‹ŸåŸå§‹é¡µé¢ç»“æ„</h2>
        <!-- æ¨¡æ‹ŸåŸå§‹é¡µé¢çš„å¿…è¦å…ƒç´  -->
        <select id="strategy-select">
            <option value="PRE_CROSS">ä¸´ç•Œé‡‘å‰</option>
        </select>
        <select id="stock-select">
            <option value="">è¯·é€‰æ‹©è‚¡ç¥¨</option>
        </select>
        <select id="adjustment-select">
            <option value="forward">å‰å¤æƒ</option>
        </select>
        
        <button id="portfolio-btn" class="portfolio-button">ğŸ’¼ æŒä»“ç®¡ç†</button>
        <div id="chart-container" style="width: 100px; height: 100px; border: 1px solid #ccc;"></div>
        
        <!-- å…¶ä»–å¿…è¦çš„å…ƒç´  -->
        <div id="backtest-results" style="display: none;"></div>
        <div id="trading-advice-panel" style="display: none;"></div>
        <div id="deep-scan-section" style="display: none;"></div>
    </div>
    
    <!-- æŒä»“ç®¡ç†æ¨¡æ€æ¡† -->
    <div id="portfolio-modal" class="modal">
        <div class="modal-content">
            <span id="portfolio-close" class="close">&times;</span>
            <h2>æŒä»“ç®¡ç†</h2>
            <div id="portfolio-content">
                <div id="portfolio-loading">åŠ è½½ä¸­...</div>
            </div>
            <button id="add-position-btn">æ·»åŠ æŒä»“</button>
            <button id="scan-portfolio-btn">æ·±åº¦æ‰«æ</button>
            <button id="refresh-portfolio-btn">åˆ·æ–°</button>
        </div>
    </div>
    
    <!-- å…¶ä»–æ¨¡æ€æ¡† -->
    <div id="add-position-modal" class="modal">
        <div class="modal-content">
            <span id="add-position-close" class="close">&times;</span>
            <h3>æ·»åŠ æŒä»“</h3>
            <form id="add-position-form">
                <button type="button" id="cancel-add-position">å–æ¶ˆ</button>
            </form>
        </div>
    </div>
    
    <div id="position-detail-modal" class="modal">
        <div class="modal-content">
            <span id="position-detail-close" class="close">&times;</span>
            <h3>æŒä»“è¯¦æƒ…</h3>
        </div>
    </div>
    
    <!-- å…¶ä»–å¿…è¦çš„æ¨¡æ€æ¡† -->
    <div id="core-pool-modal" class="modal"></div>
    <div id="history-modal" class="modal"></div>
    <div id="multi-timeframe-modal" class="modal"></div>
    
    <script>
        // æµ‹è¯•å‡½æ•°
        function runTests() {
            const results = document.getElementById('test-results');
            let html = '<h3>æµ‹è¯•ç»“æœ:</h3>';
            
            // æµ‹è¯•1: æ£€æŸ¥æŒ‰é’®æ˜¯å¦å­˜åœ¨
            const portfolioBtn = document.getElementById('portfolio-btn');
            html += `<p>æŒä»“ç®¡ç†æŒ‰é’®: ${portfolioBtn ? '<span class="success">âœ… å­˜åœ¨</span>' : '<span class="error">âŒ ä¸å­˜åœ¨</span>'}</p>`;
            
            // æµ‹è¯•2: æ£€æŸ¥æ¨¡æ€æ¡†æ˜¯å¦å­˜åœ¨
            const portfolioModal = document.getElementById('portfolio-modal');
            html += `<p>æŒä»“ç®¡ç†æ¨¡æ€æ¡†: ${portfolioModal ? '<span class="success">âœ… å­˜åœ¨</span>' : '<span class="error">âŒ ä¸å­˜åœ¨</span>'}</p>`;
            
            // æµ‹è¯•3: æ£€æŸ¥äº‹ä»¶ç›‘å¬å™¨
            if (portfolioBtn) {
                try {
                    portfolioBtn.click();
                    const isVisible = portfolioModal && portfolioModal.style.display === 'block';
                    html += `<p>æŒ‰é’®ç‚¹å‡»åŠŸèƒ½: ${isVisible ? '<span class="success">âœ… æ­£å¸¸</span>' : '<span class="error">âŒ å¼‚å¸¸</span>'}</p>`;
                } catch (e) {
                    html += `<p>æŒ‰é’®ç‚¹å‡»åŠŸèƒ½: <span class="error">âŒ é”™è¯¯: ${e.message}</span></p>`;
                }
            }
            
            results.innerHTML = html;
        }
        
        // æ¨¡æ‹Ÿåç«¯APIå“åº”
        window.fetch = function(url, options) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    if (url.includes('/api/portfolio')) {
                        resolve({
                            json: () => Promise.resolve({
                                success: true,
                                portfolio: [
                                    {
                                        stock_code: 'SZ000001',
                                        purchase_price: 10.0,
                                        quantity: 100,
                                        purchase_date: '2024-01-01',
                                        note: 'æµ‹è¯•æŒä»“'
                                    }
                                ]
                            })
                        });
                    } else {
                        resolve({
                            json: () => Promise.resolve({ success: true, data: [] })
                        });
                    }
                }, 100);
            });
        };
    </script>
    
    <!-- åŠ è½½ä¿®å¤åçš„app.js -->
    <script src="frontend/js/app.js"></script>
    
    <script>
        // é¡µé¢åŠ è½½å®Œæˆåè¿è¡Œæµ‹è¯•
        setTimeout(runTests, 1000);
    </script>
</body>
</html>